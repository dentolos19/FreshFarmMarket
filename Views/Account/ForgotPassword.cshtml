@model FreshFarmMarket.Models.ForgotPasswordViewModel
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration
@{
  ViewData["Title"] = "Forgot Password";
  ViewData["RecaptchaSiteKey"] = Configuration["ReCaptcha:SiteKey"];
}

<div class="row justify-content-center">
  <div class="col-md-5">
    <div class="card shadow-sm border-0">
      <div class="card-header bg-gradient text-dark" style="background: linear-gradient(135deg, #0dcaf0 0%, #0891b2 100%);">
        <h4 class="mb-0"><i class="bi bi-key"></i> Forgot Your Password?</h4>
      </div>
      <div class="card-body p-4">
        <p class="text-muted">Enter your email address and we'll send you a link to reset your password.</p>

        <form asp-action="ForgotPassword" method="post" id="forgotPasswordForm">
          @Html.AntiForgeryToken()

          <div asp-validation-summary="All" class="text-danger alert alert-danger" style="display: @(ViewData.ModelState.ErrorCount > 0 ? "block" : "none")"></div>

          <div class="mb-3">
            <label asp-for="Email" class="form-label"><i class="bi bi-envelope"></i> Email Address</label>
            <input asp-for="Email" class="form-control" placeholder="john@example.com" autofocus />
            <span asp-validation-for="Email" class="text-danger"></span>
          </div>

          <input type="hidden" asp-for="RecaptchaToken" id="recaptchaToken" />

          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-info btn-lg text-dark"><i class="bi bi-send"></i> Send Reset Link</button>
          </div>
        </form>

        <hr />
        <p class="text-center mb-0">
          Remember your password? <a asp-action="Login">Login here</a>
        </p>
      </div>
    </div>
  </div>
</div>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script src="https://www.google.com/recaptcha/api.js?render=@ViewData["RecaptchaSiteKey"]"></script>
  <script>
    document.getElementById('forgotPasswordForm').addEventListener('submit', function (e) {
      e.preventDefault();
      var form = this;
      var siteKey = '@Configuration["ReCaptcha:SiteKey"]';

      if (siteKey && siteKey !== 'YOUR_RECAPTCHA_SITE_KEY') {
        grecaptcha.ready(function () {
          grecaptcha.execute(siteKey, { action: 'forgot_password' }).then(function (token) {
            document.getElementById('recaptchaToken').value = token;
            form.submit();
          });
        });
      } else {
        document.getElementById('recaptchaToken').value = 'development-token';
        form.submit();
      }
    });
  </script>
}
